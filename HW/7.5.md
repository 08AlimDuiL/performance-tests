# 7.5 Практикуемся в использовании HTTP API клиентов

## Практика использования HTTP API-клиентов: получение документов по счету

**Цель задания:** закрепить навыки работы с API-клиентами. Вам необходимо доработать клиент DocumentsGatewayHTTPClient, добавив в него высокоуровневые методы get_tariff_document и get_contract_document.

Затем нужно написать скрипт, который:

1. Создаёт пользователя.
2. Открывает кредитный счёт для этого пользователя.
3. Получает документ тарифа.
4. Получает документ контракта.
В рамках задания необходимо выполнить следующие шаги:

1. Добавить реализацию методов `get_tariff_document, get_contract_document`.
   1. Все методы должны быть реализованы аналогично примерам, рассмотренным в рамках данного урока.
   2. **Создать структуру `DocumentDict`**, которая описывает JSON-объект следующего вида:
   ```
   {
     "url": "https://example.com/",
     "document": "string"
   }
   ```
                  
   3. Каждый метод должен быть корректно аннотирован. Например, для метода get_tariff_document необходимо добавить тип GetTariffDocumentResponseDict:
   class GetTariffDocumentResponseDict(TypedDict):
       tariff: DocumentDict

   4. **Каждый метод должен выполнять запрос к API, извлекать JSON-ответ и возвращать его.** Пример реализации метода `get_tariff_document:`
    ```
   def get_tariff_document(self, account_id: str) -> GetTariffDocumentResponseDict:
    response = self.get_tariff_document_api(account_id)
    return response.json()
   ```

                  
2. **Написать скрипт `api_client_get_documents.py` для получения документов по счету.**
Скрипт должен выполнять следующие действия:
   1. Создать пользователя с помощью метода клиента UsersGatewayHTTPClient.create_user (уже реализовано в данном уроке).
   2. Открыть кредитный счет  AccountsGatewatHTTPClient.open_credit_card_account (уже реализовано в данном уроке).
   3. Получить документ тарифа DocumentsGatewayHTTPClient.get_tariff_document (реализуется в рамках данного задания).
   4. Получить документ контракта DocumentsGatewayHTTPClient.get_contract_document (реализуется в рамках данного задания).
   5. Для инициализации API-клиентов используйте следующие функции:
      1. `build_users_gateway_http_client()` (уже реализовано в данном уроке).
      2.`build_accounts_gateway_http_client()` (уже реализовано в данном уроке).
      3. `build_documents_gateway_http_client()` (уже реализовано в данном уроке).
     
3. Вывести в лог информацию о созданных сущностях:
```
      Create user response: {'user': {'id': '8ac86aee-405e-455e-992b-6cd59449ca9d', 'email': 'user.1749364195.204003@example.com', 'lastName': 'string', 'firstName': 'string', 'middleName': 'string', 'phoneNumber': 'string'}}
      Open credit card account response: {'account': {'id': '686f822a-dd93-464b-ad92-50c2e9edc1fb', 'type': 'CREDIT_CARD', 'cards': [{'id': '54db13ab-5e59-4eb5-9381-196153f0ac1e', 'pin': '4722', 'cvv': '7886', 'type': 'VIRTUAL', 'status': 'ACTIVE', 'accountId': '686f822a-dd93-464b-ad92-50c2e9edc1fb', 'cardNumber': '4392196993335573', 'cardHolder': 'string string', 'expiryDate': '2032-06-06', 'paymentSystem': 'MASTERCARD'}, {'id': '23e396bc-61b1-47a0-8d3f-4e496b01bdbf', 'pin': '7295', 'cvv': '522', 'type': 'PHYSICAL', 'status': 'ACTIVE', 'accountId': '686f822a-dd93-464b-ad92-50c2e9edc1fb', 'cardNumber': '4832835104845693', 'cardHolder': 'string string', 'expiryDate': '2032-06-06', 'paymentSystem': 'MASTERCARD'}], 'status': 'ACTIVE', 'balance': 25000.0}}
      Get tariff document response: {'tariff': {'url': 'http://localhost:3000/documents/tariff_686f822a-dd93-464b-ad92-50c2e9edc1fb.pdf', 'document': 'Board view newspaper hope attack.'}}
      Get contract document response: {'contract': {'url': 'http://localhost:3000/documents/contract_686f822a-dd93-464b-ad92-50c2e9edc1fb.pdf', 'document': 'Must surface first reality everything traditional.'}}
```
                  
**Важно!** Необязательно, чтобы данные совпадали один в один, главное — успешное выполнение всех запросов и корректное получение документов.

Структура расположения файла api_client_get_documents.py:
```
.
└── performance-tests/
    └── api_client_get_documents.py
```
                  
**Требования к коду:**
- [ ] Читаемость и структурированность.
- [ ] Соблюдение стандартов аннотации типов.
- [ ] Корректное именование классов и методов.
- [ ] Обязательное документирование кода с помощью docstring.
---------------------------------
## Практика использования HTTP API-клиентов: создание операции пополнения счета

**Цель задания:** закрепить навыки работы с API-клиентами. Вам необходимо доработать клиент OperationsGatewayHTTPClient, добавив в него высокоуровневые методы:

* get_operation
* get_operation_receipt
* get_operations
* get_operations_summary
* make_fee_operation
* make_top_up_operation
* make_cashback_operation
* make_transfer_operation
* make_purchase_operation
* make_bill_payment_operation
* make_cash_withdrawal_operation

Затем нужно написать скрипт, который:

1. Создаёт пользователя.
2. Открывает дебетовый счёт для этого пользователя.
3. Создает операцию пополнение дебетового счета.

В рамках задания необходимо выполнить следующие шаги:

1. Добавить билдер для клиента `OperationsGatewayHTTPClient.` Для реализации билдера используйте функцию `build_gateway_http_client.`
2. Добавить реализацию методов `get_operation, get_operation_receipt, get_operations, get_operations_summary, make_fee_operation, make_top_up_operation, make_cashback_operation, make_transfer_operation, make_purchase_operation, make_bill_payment_operation, make_cash_withdrawal_operation.`
   1. Все методы должны быть реализованы аналогично примерам, рассмотренным в рамках данного урока.
   2. **Создать структуру** `OperationDict`, которая описывает JSON-объект следующего вида:
```
{
  "id": "string",
  "type": "FEE",
  "status": "FAILED",
  "amount": 0,
  "cardId": "string",
  "category": "string",
  "createdAt": "2025-06-08T06:50:17.124Z",
  "accountId": "string"
}
```
                  
3. Создать структуру OperationReceiptDict, которая описывает JSON-объект следующего вида:
    ```
        {
          "url": "https://example.com/",
          "document": "string"
        }
    ```

4. Создать структуру OperationsSummaryDict, которая описывает JSON-объект следующего вида:

```
{
  "spentAmount": 0,
  "receivedAmount": 0,
  "cashbackAmount": 0
}
```
                  
5. **Каждый метод должен быть корректно аннотирован.** Например, для метода `get_operations необходимо добавить тип `GetOperationsResponseDict:`
```
class GetOperationsResponseDict(TypedDict):
    operations: list[OperationDict]
```
                  
6. **Каждый метод должен выполнять запрос к API, извлекать JSON-ответ и возвращать его.** Пример реализации метода `make_fee_operation:`
```
def make_fee_operation(self, card_id: str, account_id: str) -> MakeFeeOperationResponseDict:
    request = MakeFeeOperationRequestDict(
        status="COMPLETED",
        amount=55.77,
        cardId=card_id,
        accountId=account_id
    )
    response = self.make_fee_operation_api(request)
    return response.json()
```
                  
Пример реализации метода `get_operations:`
```
def get_operations(self, account_id: str) -> GetOperationsResponseDict:
    query = GetOperationsQueryDict(accountId=account_id)
    response = self.get_operations_api(query)
    return response.json()
```
                  
3. **Написать скрипт**  `api_client_make_top_up_operation.py` **для создания операции пополнения счета.** Скрипт должен выполнять следующие действия:
   1. Создать пользователя с помощью метода клиента UsersGatewayHTTPClient.create_user (уже реализовано в данном уроке).
   2. Открыть дебетовый счет  AccountsGatewatHTTPClient.open_debit_card_account (уже реализовано в данном уроке).
   3. Создать операцию пополнения счета OperationsGatewayHTTPClient.make_top_up_operations (реализуется в рамках данного задания).
   4. Для инициализации API-клиентов используйте следующие функции:
   
      1. build_users_gateway_http_client() (уже реализовано в данном уроке).
      2. build_accounts_gateway_http_client() (уже реализовано в данном уроке).
      3. build_operations_gateway_http_client() (реализуется в рамках данного задания).

Вывести в лог информацию о созданных сущностях:
```
Create user response: {'user': {'id': '61908602-1ac3-4e20-9554-85e01f63d71e', 'email': 'user.1749369721.6589901@example.com', 'lastName': 'string', 'firstName': 'string', 'middleName': 'string', 'phoneNumber': 'string'}}
Open debit card account response: {'account': {'id': 'cc9c9dad-7cb7-4003-a5cc-e2dd3bca58d8', 'type': 'DEBIT_CARD', 'cards': [{'id': '5b8d5d34-3888-45ae-9455-7c70cf0521f7', 'pin': '9154', 'cvv': '212', 'type': 'VIRTUAL', 'status': 'ACTIVE', 'accountId': 'cc9c9dad-7cb7-4003-a5cc-e2dd3bca58d8', 'cardNumber': '4943854212695667704', 'cardHolder': 'string string', 'expiryDate': '2032-06-06', 'paymentSystem': 'MASTERCARD'}, {'id': '816fffdd-a774-4f88-8d76-0e695c5fcf8d', 'pin': '1757', 'cvv': '994', 'type': 'PHYSICAL', 'status': 'ACTIVE', 'accountId': 'cc9c9dad-7cb7-4003-a5cc-e2dd3bca58d8', 'cardNumber': '3500663622495780', 'cardHolder': 'string string', 'expiryDate': '2032-06-06', 'paymentSystem': 'MASTERCARD'}], 'status': 'ACTIVE', 'balance': 0.0}}
Make top up operation response: {'operation': {'id': '4489f3cb-72f5-4ccd-b32c-6f4809b4687a', 'type': 'TOP_UP', 'status': 'COMPLETED', 'amount': 1500.11, 'cardId': '5b8d5d34-3888-45ae-9455-7c70cf0521f7', 'category': 'money_in', 'createdAt': '2025-06-08T08:02:03.517909', 'accountId': 'cc9c9dad-7cb7-4003-a5cc-e2dd3bca58d8'}}
```
                  
**Важно!** Необязательно, чтобы данные совпадали один в один, главное — успешное выполнение всех запросов и корректное создание операции пополнения счета.
**Важно!** Клиент OperationsGatewayHTTPClient необходимо было реализовать в рамках домашнего задания урока "Практикуемся в реализации HTTP API клиентов". Если вы пропустили этот шаг, рекомендуем вернуться и внимательно разобраться с его реализацией, так как без этого выполнение текущего задания будет невозможно.

Структура расположения файла api_client_make_top_up_operation.py:
```
.
└── performance-tests/
    └── api_client_make_top_up_operation.py
```
                  
**Требования к коду:**
- [ ] Читаемость и структурированность.
- [ ] Соблюдение стандартов аннотации типов.
- [ ] Корректное именование классов и методов.
- [ ] Обязательное документирование кода с помощью docstring.

--------------------------
